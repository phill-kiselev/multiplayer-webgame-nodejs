(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{48:function(e,t,n){e.exports=n(83)},69:function(e,t){},82:function(e,t,n){},83:function(e,t,n){"use strict";n.r(t);var i,s,o=n(0),a=n.n(o),r=n(43),c=n.n(r),l=n(13),h=n(16),u=n(45),d=n(6),m=n(4),v=n(14),p=n(12),f=n(15),y=n(22),g=n(3),w=n(47),M=n(1),b=function(e){function t(e){var n;return Object(d.a)(this,t),(n=Object(v.a)(this,Object(p.a)(t).call(this,e))).scene=void 0,n.engine=void 0,n.canvas=void 0,n.onResizeWindow=function(){n.engine&&n.engine.resize()},n.scene=null,n.engine=null,n.canvas=a.a.createRef(),n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"shouldComponentUpdate",value:function(e,t){return!1}},{key:"componentDidMount",value:function(){this.engine=new M.Engine(this.canvas.current,!0,this.props.engineOptions,this.props.adaptToDeviceRatio),this.scene=new M.Scene(this.engine),"function"===typeof this.props.onSceneMount?this.props.onSceneMount({scene:this.scene,engine:this.engine,canvas:this.canvas.current}):console.error("onSceneMount function not available"),window.addEventListener("resize",this.onResizeWindow)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResizeWindow),this.scene.dispose(),this.engine.dispose()}},{key:"render",value:function(){var e=this.props,t=e.width,n=e.height,i=(Object(w.a)(e,["width","height"]),{});return void 0!==t&&void 0!==n&&(i.width=t,i.height=n),a.a.createElement("canvas",Object.assign({id:"renderCanvas"},i,{ref:this.canvas}))}}]),t}(o.Component),k="ADD_GAME_CLIENT",E="REMOVE_GAME_CLIENT";!function(e){e.ONGOING="ong",e.WIN="win",e.LOSE="los",e.OVER="ovr"}(i||(i={})),function(e){e.PLAYER_MOVEMENT="move"}(s||(s={}));var O=function(){function e(t,n,i){Object(d.a)(this,e),this.client=void 0,this.roomId=void 0,this.world=void 0,this.room=void 0,this.client=t,this.roomId="new"===i?"game":i,this.world=n}return Object(m.a)(e,[{key:"connect",value:function(){var e=this;this.client.joinOrCreate("game").then(function(t){e.room=t,console.log("client joined successfully"),e.setupMessageListeners()}).catch(function(e){console.error("join error",e)})}},{key:"setupMessageListeners",value:function(){var e=this;this.room.state.players.onAdd=function(t,n){n!==e.room.sessionId&&e.world.addRival(n,new M.Vector3(t.x,1,t.y))},this.room.state.players.onChange=function(t,n){n===e.room.sessionId?e.world.updatePlayer(n,new M.Vector3(t.x,1,t.y)):e.world.updateRival(n,new M.Vector3(t.x,1,t.y))},this.room.state.players.onRemove=function(t,n){e.world.removeRival(n)}}},{key:"sendMovement",value:function(e,t,n,i,o){this.room.send(s.PLAYER_MOVEMENT,{direction:e,keyUp:t,keyDown:n,keyLeft:i,keyRight:o})}}]),e}(),C=n(11),R=n.n(C),j=n(17),S=[65,"a"],A=[68,"d"],N=[87,"w"],D=[83,"s"],I=function(){function e(t){Object(d.a)(this,e),this.scene=void 0,this.keyDown={},this.keyFired={},this.camera=void 0,this.mesh=void 0,this.staff=void 0,this.scene=t,this.mesh=M.MeshBuilder.CreateSphere("im",{diameter:.2},this.scene),this.staff=M.MeshBuilder.CreateSphere("mystaff",{diameter:.2},this.scene);M.MeshBuilder.CreateCylinder("collider",{diameter:.8,height:1.4},this.scene);this.loadMage()}return Object(m.a)(e,[{key:"loadMage",value:function(){var e=Object(j.a)(R.a.mark(function e(){var t,n,i=this;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=new M.AssetsManager(this.scene),(n=t.addMeshTask("Mage","","/assets/","Mages_1to4_babylon.babylon")).onSuccess=function(e){console.log("Loading Mage successed!"),e.loadedMeshes[5].position=i.mesh.position,e.loadedMeshes[1].dispose(),e.loadedMeshes[2].dispose(),e.loadedMeshes[3].dispose(),e.loadedMeshes[4].dispose(),e.loadedMeshes[6].dispose(),e.loadedMeshes[7].dispose(),i.staff.dispose(),i.mesh.dispose(),i.staff=e.loadedMeshes[0],i.mesh=e.loadedMeshes[5],i.staff.parent=i.mesh,i.camera.lockedTarget=i.mesh},n.onError=function(e,t,n){console.log(t,n)},t.load();case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"init",value:function(e){this.camera=new M.ArcRotateCamera("Camera",Math.PI/4,Math.PI/5,15,new M.Vector3(0,0,1),this.scene),this.camera.lockedTarget=this.mesh,this.scene.activeCamera=this.camera,this.camera.attachControl(this.scene.getEngine().getRenderingCanvas(),!0)}},{key:"keyDownEvt",value:function(e){this.keyFired[e]||(this.keyDown[e]=!0,this.keyFired[e]=!0)}},{key:"keyUpEvt",value:function(e){this.keyDown[e]=!1,this.keyFired[e]=!1}},{key:"setupControls",value:function(e){var t=this;[S,A,N,D].forEach(function(n){e.registerAction(new M.ExecuteCodeAction({trigger:M.ActionManager.OnKeyUpTrigger,parameter:n[1]},function(){return t.keyUpEvt(n[0])})),e.registerAction(new M.ExecuteCodeAction({trigger:M.ActionManager.OnKeyDownTrigger,parameter:n[1]},function(){return t.keyDownEvt(n[0])}))})}},{key:"sendMovement",value:function(e){if(this.keyDown[N[0]]||this.keyDown[D[0]]||this.keyDown[S[0]]||this.keyDown[A[0]]){var t=this.mesh.getFacetPosition(1).subtract(this.mesh.position);e.sendMovement(new M.Vector2(t.x,t.z).normalize(),this.keyDown[N[0]],this.keyDown[D[0]],this.keyDown[S[0]],this.keyDown[A[0]])}}},{key:"update",value:function(e){this.mesh.position.x=e.x,this.mesh.position.z=e.z}}]),e}(),_=function(){function e(t,n){Object(d.a)(this,e),this.scene=void 0,this.id=void 0,this.mesh=void 0,this.staff=void 0,this.scene=t,this.id=n,this.mesh=M.MeshBuilder.CreateSphere(n,{diameter:.2},this.scene),this.staff=M.MeshBuilder.CreateSphere(n,{diameter:.2},this.scene),this.loadMage()}return Object(m.a)(e,[{key:"loadMage",value:function(){var e=Object(j.a)(R.a.mark(function e(){var t,n,i=this;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=new M.AssetsManager(this.scene),(n=t.addMeshTask("Mage","","/assets/","Mages_1to4_babylon.babylon")).onSuccess=function(e){console.log("Loading Mage successed!"),e.loadedMeshes[5].position=i.mesh.position,e.loadedMeshes[1].dispose(),e.loadedMeshes[2].dispose(),e.loadedMeshes[3].dispose(),e.loadedMeshes[4].dispose(),e.loadedMeshes[6].dispose(),e.loadedMeshes[7].dispose(),i.staff.dispose(),i.mesh.dispose(),i.staff=e.loadedMeshes[0],i.mesh=e.loadedMeshes[5],i.staff.parent=i.mesh},n.onError=function(e,t,n){console.log(t,n)},t.load();case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}]),Object(m.a)(e,[{key:"init",value:function(e){this.mesh.position=e}},{key:"update",value:function(e){this.mesh.position=e}}]),e}(),x=function(){function e(t){Object(d.a)(this,e),this.canvas=void 0,this.engine=void 0,this.scene=void 0,this.player=void 0,this.rivals={},this.routerService=void 0,this.canvas=t.canvas,this.engine=t.engine,this.scene=t.scene}return Object(m.a)(e,[{key:"run",value:function(){var e=this;this.scene.actionManager=new M.ActionManager(this.scene);var t=M.MeshBuilder.CreateGround("ground",{width:100,height:100},this.scene),n=new M.StandardMaterial("groundMat",this.scene);n.diffuseColor=new M.Color3(.2,.2,.5),t.material=n,t.checkCollisions=!0,this.player=new I(this.scene),this.player.init(new M.Vector3(0,1,0)),this.player.setupControls(this.scene.actionManager),new M.HemisphericLight("light1",new M.Vector3(0,1,0),this.scene).intensity=.7;var i=new M.StandardMaterial("impMat",this.scene);i.diffuseColor=new M.Color3(0,0,0);var s=M.MeshBuilder.CreateSphere("sphere",{diameter:0,diameterX:.3,diameterY:.01,diameterZ:.3,updatable:!0},this.scene);s.material=i,this.scene.onPointerDown=function(e,t){t.hit&&(s.position.x=t.pickedPoint.x,s.position.z=t.pickedPoint.z,s.position.y=t.pickedPoint.y)},this.engine.runRenderLoop(function(){e.player&&e.routerService&&e.player.sendMovement(e.routerService),e.scene&&e.scene.render()})}},{key:"associateRouterService",value:function(e){this.routerService=e}},{key:"addRival",value:function(e,t){var n=new _(this.scene,e);n.init(t),this.rivals[e]=n}},{key:"removeRival",value:function(e){var t=this.rivals[e];t&&(t.mesh.dispose(),delete this.rivals[e])}},{key:"updateRival",value:function(e,t){this.rivals[e].update(t)}},{key:"updatePlayer",value:function(e,t){this.player.update(t)}}]),e}(),L=function(e){function t(){var e,n;Object(d.a)(this,t);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return(n=Object(v.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(s)))).world=void 0,n.routerService=void 0,n.onSceneMount=function(e){n.world=new x(e),n.world.run(),n.routerService=new O(n.props.client,n.world,n.props.match.params.roomId),n.routerService.connect(),n.world.associateRouterService(n.routerService)},n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"componentWillUnmount",value:function(){this.routerService.room.leave()}},{key:"render",value:function(){return o.createElement("div",{className:"game-wrapper"},o.createElement(b,{onSceneMount:this.onSceneMount,adaptToDeviceRatio:!0}))}}]),t}(o.Component),T=Object(l.b)(function(e){return{client:e.gameClient.client}},null)(L),P=n(46);function V(e){return{type:k,client:e}}var z=function(e){function t(){var e,n;Object(d.a)(this,t);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return(n=Object(v.a)(this,(e=Object(p.a)(t)).call.apply(e,[this].concat(s)))).state={availableRooms:[],selectedRoom:void 0},n.checkRoomsInterval=void 0,n.getAvailableRooms=function(){n.props.client&&n.props.client.getAvailableRooms("game").then(function(e){e&&n.setState({availableRooms:e})})},n.selectRoom=function(e){n.setState({selectedRoom:e})},n}return Object(f.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.checkRoomsInterval=setInterval(this.getAvailableRooms,3e3),this.getAvailableRooms()}},{key:"componentWillUnmount",value:function(){clearInterval(this.checkRoomsInterval)}},{key:"renderAvailableRooms",value:function(){var e=this,t=this.state.availableRooms;return 0===t.length?a.a.createElement("div",{className:"item"},"It seems no one is playing at the moment."):t.map(function(t){var n=t.roomId===e.state.selectedRoom;return a.a.createElement("div",{className:"item".concat(n?" selected":""),key:t.roomId,onClick:function(){return e.selectRoom(t.roomId)}},n&&a.a.createElement("div",{className:"right floated content"},a.a.createElement(y.b,{to:{pathname:"/game/".concat(t.roomId)}},a.a.createElement("div",{className:"ui primary button"},"Join"))),a.a.createElement("div",{className:"content"},a.a.createElement("div",{className:"header"},t.roomId),a.a.createElement("div",{className:"description"},t.clients,"/",t.maxClients)))})}},{key:"render",value:function(){return a.a.createElement("div",{className:"ui container"},a.a.createElement("div",{className:"ui raised segment"},a.a.createElement("h3",{className:"ui header"},a.a.createElement("i",{className:"circular inverted users icon"}),a.a.createElement("div",{className:"content"},"Available rooms",a.a.createElement("div",{className:"sub header"},"Choose one to join"))),a.a.createElement("div",{className:"ui divided list"},this.renderAvailableRooms()),a.a.createElement(y.b,{to:{pathname:"/game/new"}},a.a.createElement("div",{className:"ui primary button"},"Create new room"))))}}]),t}(o.Component),U=Object(l.b)(function(e){return{client:e.gameClient.client}},null)(z),B=(n(82),function(e){function t(){return Object(d.a)(this,t),Object(v.a)(this,Object(p.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){this.props.connectToGameClient()}},{key:"render",value:function(){return this.props.client?a.a.createElement("div",{className:"App"},a.a.createElement(y.a,null,a.a.createElement("div",{className:"router-wrapper"},a.a.createElement(g.c,null,a.a.createElement(g.a,{path:"/",exact:!0,component:U}),a.a.createElement(g.a,{path:"/game/:roomId",exact:!0,component:T}))))):null}}]),t}(o.Component)),G=Object(l.b)(function(e){return{client:e.gameClient.client}},{connectToGameClient:function(){return function(){var e=Object(j.a)(R.a.mark(function e(t){var n,i;return R.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_GAME_SERVER_URL,i=new P.Client(n),e.next=4,t(V(i));case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}})(B),W=Object(h.c)({gameClient:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{client:null},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case k:return{client:t.client};case E:return e.client,{client:null}}return e}}),F=("undefined"===typeof window?null:window).__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||h.d,J=Object(h.e)(W,F(Object(h.a)(u.a)));c.a.render(a.a.createElement(l.a,{store:J},a.a.createElement(G,null)),document.getElementById("root"))}},[[48,1,2]]]);
//# sourceMappingURL=main.c3db6a6c.chunk.js.map